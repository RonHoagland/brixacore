{% extends "layouts/app_shell.html" %}

{% block title %}User Detail - BrixaWares{% endblock %}
{% block page_title %}User: {{ user_obj.username }}{% endblock %}

{% block main_content %}
<div class="card" style="background: white; padding: var(--bx-spacing-lg); border-radius: 8px; border: 1px solid var(--bx-color-border); max-width: 600px;">
    
    <div style="margin-bottom: var(--bx-spacing-lg);">
        <h3 style="margin-bottom: var(--bx-spacing-sm);">Profile</h3>
        <p><strong>Username:</strong> {{ user_obj.username }}</p>
        <p><strong>Email:</strong> {{ user_obj.email|default:"N/A" }}</p>
        <p><strong>Last Login:</strong> {{ user_obj.last_login|default:"Never" }}</p>
        <p><strong>Date Joined:</strong> {{ user_obj.date_joined|date:"M d, Y" }}</p>
    </div>

    <div style="margin-bottom: var(--bx-spacing-lg);">
        <h3 style="margin-bottom: var(--bx-spacing-sm);">Status</h3>
        <div style="display: flex; align-items: center; gap: var(--bx-spacing-md);">
            <span>
                Currently: 
                {% if user_obj.is_active %}
                <strong style="color: var(--bx-color-success);">Active</strong>
                {% else %}
                <strong style="color: var(--bx-color-danger);">Inactive</strong>
                {% endif %}
            </span>
            
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="toggle_active">
                <button type="submit" style="padding: 0.25rem 0.75rem; border: 1px solid var(--bx-color-border); border-radius: 4px; background: var(--bx-color-bg-body); cursor: pointer;">
                    {% if user_obj.is_active %}Deactivate{% else %}Activate{% endif %}
                </button>
            </form>
        </div>
    </div>

    <!-- Roles Section -->
    <div style="margin-bottom: var(--bx-spacing-lg); border-top: 1px solid var(--bx-color-border); padding-top: var(--bx-spacing-lg);">
        <h3 style="margin-bottom: var(--bx-spacing-sm);">Assigned Roles</h3>
        
        {% if user_obj.user_roles.exists %}
        <ul style="list-style: none; padding: 0; margin-bottom: var(--bx-spacing-md);">
            {% for ur in user_obj.user_roles.all %}
            <li style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--bx-color-bg-body); border-radius: 4px; margin-bottom: 4px;">
                <span>
                    <strong>{{ ur.role.name }}</strong> 
                    <span style="color: var(--bx-color-text-muted); font-size: 0.9em;">({{ ur.role.key }})</span>
                </span>
                <div>
                    <a href="{% url 'role_delete_confirm' user_id=user_obj.id role_id=ur.role.id %}" 
                       style="color: var(--bx-color-danger); font-size: 0.9em; text-decoration: none;">
                       Remove
                    </a>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p style="color: var(--bx-color-text-muted); font-style: italic; margin-bottom: var(--bx-spacing-md);">No roles assigned.</p>
        {% endif %}

        <!-- Assign Role Form -->
        <form method="post" style="display: flex; gap: 8px;">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_role">
            <select name="role_id" style="flex: 1; padding: 8px; border: 1px solid var(--bx-color-border); border-radius: 4px;">
                <option value="">Select role to assign...</option>
                {% for r in available_roles %}
                <option value="{{ r.id }}">{{ r.name }}</option>
                {% endfor %}
            </select>
            <button type="submit" style="background: var(--bx-color-primary); color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">Assign</button>
        </form>
    </div>

    <div style="margin-bottom: var(--bx-spacing-lg);">
        <a href="{% url 'user_list' %}" style="text-decoration: underline; color: var(--bx-color-text-muted);">Back to Users</a>
    </div>

</div>
{% endblock %}
